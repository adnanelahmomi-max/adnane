<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù†ÙˆØ± Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ù† Ø¹Ù„Ø§Ù„ - Ù†Ø¸Ø§Ù… ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø§Ø¡</title>
<style>
:root {
  --gold: #ffd700;
  --overlay: rgba(0,0,0,0.7);
  --card: rgba(30,30,30,0.95);
}
*{box-sizing:border-box}
body{
  margin:0; font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
  background: url('background.jpg') no-repeat center center fixed;
  background-size: cover; color:#fff;
}
.overlay{
  background:var(--overlay); min-height:100vh; padding:20px;
}
.header{
  background: linear-gradient(45deg,var(--gold),#e6c200); color:#111;
  padding:12px; border-radius:10px; text-align:center; box-shadow:0 6px 18px rgba(0,0,0,0.4);
  margin-bottom:14px;
}
.header img{width:90px;border-radius:8px;display:block;margin:6px auto;}
.header h1{margin:6px 0 0;font-size:20px;}
.header p{margin:6px 0 0;color:#222;font-size:14px;}
.card{background:var(--card); padding:14px; border-radius:10px; margin-bottom:12px; box-shadow:0 8px 22px rgba(0,0,0,0.6);}
button{background:linear-gradient(45deg,var(--gold),#e6c200);border:none;padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:700;margin:6px 4px;}
button:hover{transform:translateY(-2px)}
.page{display:none}
.page.active{display:block}
input,select{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #444;background:#111;color:#fff}
.month-item{background:#007bff;color:#fff;border-radius:8px;padding:10px;margin:8px 0;display:flex;justify-content:space-between;align-items:center}
.controls{display:flex;gap:8px}
.small-btn{padding:6px 8px;border-radius:6px;border:none;cursor:pointer;font-weight:700}
.remove{background:#e74c3c;color:#fff}
.edit{background:#f39c12;color:#111}
.print{background:#27ae60;color:#fff}
.welcome{font-size:1.1rem;color:var(--gold);text-shadow:1px 1px 3px #000;margin-top:10px}
.footer{opacity:0.85;text-align:center;margin-top:12px;font-size:13px}
@media(max-width:600px){
  .header h1{font-size:18px}
  .header img{width:70px}
  button{width:100%}
}
</style>
</head>
<body>
<div class="overlay">
  <div class="header">
    <img src="logo.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©">
    <h1>ğŸ’§ Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù†ÙˆØ± Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ù† Ø¹Ù„Ø§Ù„ Ù„Ù„ØªÙ†Ù…ÙŠØ© ÙˆØ§Ù„ØªØ¹Ø§ÙˆÙ† - Ù…Ø±Ø³ Ø§Ù„Ø­Ø¬Ø±</h1>
    <p class="welcome">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙÙˆØ§ØªÙŠØ± Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù†ÙˆØ± Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ù† Ø¹Ù„Ø§Ù„ Ù„Ù„ØªÙ†Ù…ÙŠØ© ÙˆØ§Ù„ØªØ¹Ø§ÙˆÙ† Ù…Ø±Ø³ Ø§Ù„Ø­Ø¬Ø±</p>
  </div>

  <div class="card" style="text-align:center">
    <button onclick="showPage('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button onclick="showPage('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div id="home" class="page active card" style="text-align:center">
    <h2>ğŸŒ¿ Ù†Ø¸Ø§Ù… ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¹ØµØ±ÙŠ</h2>
    <p class="welcome">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ Ù…Ù†ØµØ© Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù†ÙˆØ± Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø§Ø¡ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø­Ø¯ÙŠØ«Ø© ÙˆØ³Ù‡Ù„Ø©</p>
  </div>

  <div id="login" class="page card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø®ÙˆÙ„:</label>
    <select id="userType">
      <option value="customer">Ù…Ø´ØªØ±Ùƒ</option>
      <option value="admin">Ù…Ø¯ÙŠØ±</option>
    </select>
    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± / ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±Ùƒ</label>
    <input type="password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±Ùƒ" />
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Admin dashboard -->
  <div id="admin-dashboard" class="page">
    <div class="card">
      <h3 style="margin-top:0">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
      <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
      <button onclick="exportToExcel()">ğŸ’¾ ØªØµØ¯ÙŠØ± Excel</button>
    </div>

    <div class="card">
      <h4 style="margin-top:0">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ Ø¬Ø¯ÙŠØ¯</h4>
      <input type="text" id="newCustomerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ" />
      <input type="text" id="newCustomerCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±Ùƒ" />
      <button onclick="addCustomer()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´ØªØ±Ùƒ</button>
    </div>

    <div class="card">
      <h4 style="margin-top:0">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h4>
      <div id="customerList"></div>
    </div>

    <div class="card">
      <h4 style="margin-top:0">ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±Ùƒ</h4>
      <select id="selectedCustomer" onchange="renderMonths()">
        <option value="">Ø§Ø®ØªØ± Ù…Ø´ØªØ±Ùƒ</option>
      </select>
      <input type="number" id="monthConsumption" placeholder="Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø¨Ø§Ù„Ù…ØªØ±Â³" />
      <button onclick="addMonth()">Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø©</button>
      <div id="monthList"></div>
    </div>
  </div>

  <!-- Customer dashboard (read-only) -->
  <div id="customer-dashboard" class="page card">
    <h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ <span id="customerNameDisplay"></span></h3>
    <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
    <h4>ğŸ’µ ÙÙˆØ§ØªÙŠØ±Ùƒ</h4>
    <div id="customerMonths"></div>
  </div>

  <div class="footer">Â© <span id="year"></span> Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù†ÙˆØ± Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ù† Ø¹Ù„Ø§Ù„ Ù„Ù„ØªÙ†Ù…ÙŠØ© ÙˆØ§Ù„ØªØ¹Ø§ÙˆÙ†</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
const adminPassword = "236263";
let customers = JSON.parse(localStorage.getItem('customersData') || '[]');
document.getElementById('year').innerText = new Date().getFullYear();

function saveData(){ localStorage.setItem('customersData', JSON.stringify(customers)); }
function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); }

function login(){
  const type = document.getElementById('userType').value;
  const pass = document.getElementById('password').value.trim();
  if(type === 'admin'){
    if(pass === adminPassword){ showPage('admin-dashboard'); renderCustomers(); }
    else alert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ± Ø®Ø§Ø·Ø¦Ø©');
  } else {
    const user = customers.find(c => c.code === pass);
    if(user){ showPage('customer-dashboard'); document.getElementById('customerNameDisplay').innerText = user.name; renderCustomerMonths(user); }
    else alert('ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±Ùƒ ØºÙŠØ± ØµØ­ÙŠØ­');
  }
}

function logout(){ showPage('login'); }

// Admin functions
function addCustomer(){
  const name = document.getElementById('newCustomerName').value.trim();
  const code = document.getElementById('newCustomerCode').value.trim();
  if(!name || !code){ alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯'); return; }
  customers.push({ name, code, months: [] });
  saveData(); document.getElementById('newCustomerName').value=''; document.getElementById('newCustomerCode').value='';
  renderCustomers(); alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´ØªØ±Ùƒ');
}

function renderCustomers(){
  const listDiv = document.getElementById('customerList');
  const select = document.getElementById('selectedCustomer');
  listDiv.innerHTML = ''; select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…Ø´ØªØ±Ùƒ</option>';
  customers.forEach((c,i) => {
    listDiv.innerHTML += `<p>${i+1}. ${c.name} <button style="background:#e74c3c;color:#fff" onclick="removeCustomer(${i})">Ø­Ø°Ù</button></p>`;
    select.innerHTML += `<option value="${i}">${c.name}</option>`;
  });
  renderMonths();
}

function removeCustomer(i){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´ØªØ±ÙƒØŸ')){ customers.splice(i,1); saveData(); renderCustomers(); document.getElementById('monthList').innerHTML=''; }
}

function addMonth(){
  const idx = document.getElementById('selectedCustomer').value;
  const cons = parseFloat(document.getElementById('monthConsumption').value);
  if(idx === '' || !cons || cons <= 0){ alert('Ø§Ø®ØªØ± Ù…Ø´ØªØ±Ùƒ ÙˆØ£Ø¯Ø®Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ØµØ§Ù„Ø­'); return; }
  customers[idx].months.push({ consumption: cons });
  saveData(); document.getElementById('monthConsumption').value=''; renderMonths();
}

function renderMonths(){
  const idx = document.getElementById('selectedCustomer').value;
  const monthList = document.getElementById('monthList');
  monthList.innerHTML = '';
  if(idx === '') return;
  customers[idx].months.forEach((m,i) => {
    monthList.innerHTML += `<div class="month-item"><span>Ø´Ù‡Ø± ${i+1}: ${m.consumption} Ù…Â³ = ${m.consumption*3} Ø¯Ø±Ù‡Ù…</span>
      <div class="controls">
        <button class="small-btn edit" onclick="editMonth(${idx},${i})">âœï¸</button>
        <button class="small-btn print" onclick="printInvoice(${idx},${i})">ğŸ–¨ï¸</button>
        <button class="small-btn remove" onclick="removeMonth(${idx},${i})">Ã—</button>
      </div></div>`;
  });
}
function removeMonth(cIdx,mIdx){ if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ')){ customers[cIdx].months.splice(mIdx,1); saveData(); renderMonths(); } }

function editMonth(cIdx,mIdx){
  const current = customers[cIdx].months[mIdx].consumption;
  const newVal = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø¨Ø§Ù„Ù…ØªØ±Â³:', current);
  if(newVal !== null){ const n = parseFloat(newVal); if(!isNaN(n) && n>0){ customers[cIdx].months[mIdx].consumption = n; saveData(); renderMonths(); alert('âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©'); } else alert('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©'); }
}

function renderCustomerMonths(user){
  const div = document.getElementById('customerMonths'); div.innerHTML=''; if(!user.months || user.months.length===0){ div.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø¨Ø¹Ø¯.</p>'; return; } user.months.forEach((m,i)=>{ div.innerHTML += `<div class="month-item"><span>Ø´Ù‡Ø± ${i+1}: ${m.consumption} Ù…Â³ = ${m.consumption*3} Ø¯Ø±Ù‡Ù…</span></div>`; }); }

function printInvoice(cIdx,mIdx){
  const customer = customers[cIdx]; const invoice = customer.months[mIdx]; const amount = (invoice.consumption * 3).toFixed(2); const dateStr = new Date().toLocaleDateString('ar-MA'); const popup = window.open('', '_blank', 'width=700,height=800'); popup.document.write(`
    <html dir="rtl"><head><title>ÙØ§ØªÙˆØ±Ø© - ${customer.name}</title></head><body style="font-family:Tahoma;padding:20px;text-align:center;">
    <img src="logo.jpg" style="width:100px"><h2>Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù†ÙˆØ± Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ù† Ø¹Ù„Ø§Ù„ Ù„Ù„ØªÙ†Ù…ÙŠØ© Ùˆ Ø§Ù„ØªØ¹Ø§ÙˆÙ†</h2><h3>ÙØ§ØªÙˆØ±Ø© Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…Ø§Ø¡</h3><hr>
    <p><b>Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ:</b> ${customer.name}</p>
    <p><b>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´ØªØ±Ùƒ:</b> ${customer.code}</p>
    <p><b>Ø§Ù„Ø´Ù‡Ø±:</b> ${mIdx+1}</p>
    <p><b>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ:</b> ${invoice.consumption} Ù…Â³</p>
    <p><b>Ø§Ù„Ù…Ø¨Ù„Øº:</b> ${amount} Ø¯Ø±Ù‡Ù…</p><hr>
    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${dateStr}</p></body></html>`);
  popup.print(); }

function exportToExcel(){
  if(customers.length === 0){ alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±'); return; }
  const today = new Date(); const dateStr = today.toISOString().slice(0,10); const rows = [['Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ','ÙƒÙˆØ¯','Ø§Ù„Ø´Ù‡Ø±','Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ (Ù…Â³)','Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø±Ù‡Ù…)']]; customers.forEach(c => { if(!c.months || c.months.length === 0) rows.push([c.name,c.code,'-','-','-']); else c.months.forEach((m,i) => rows.push([c.name,c.code,`Ø´Ù‡Ø± ${i+1}`, m.consumption, m.consumption*3])); }); const wb = XLSX.utils.book_new(); const ws = XLSX.utils.aoa_to_sheet(rows); XLSX.utils.book_append_sheet(wb,ws,'ÙÙˆØ§ØªÙŠØ±'); XLSX.writeFile(wb, `ÙÙˆØ§ØªÙŠØ±_Ø¬Ù…Ø¹ÙŠØ©_Ø§Ù„Ù†ÙˆØ±_${dateStr}.xlsx`); alert('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­'); }

</script>
</body>
</html>
